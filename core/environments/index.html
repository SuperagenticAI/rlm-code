<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ğŸš€ Research Playground & Evaluation OS for Recursive Language Model Agentic Systems"><meta name=author content="Shashi Jagtap"><link href=https://superagenticai.github.io/rlm-code/core/environments/ rel=canonical><link href=../runner/ rel=prev><link href=../execution-patterns/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>ğŸŒ Environments - RLM Code ğŸ§ª</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#environments class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="RLM Code ğŸ§ª" class="md-header__button md-logo" aria-label="RLM Code ğŸ§ª" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> RLM Code ğŸ§ª </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ğŸŒ Environments </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=purple aria-label="â˜€ï¸ Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="â˜€ï¸ Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=purple aria-label="ğŸŒ™ Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="ğŸŒ™ Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/SuperagenticAI/rlm-code title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> SuperagenticAI/rlm-code </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> ğŸ  Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> ğŸš€ Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> ğŸ§  Core Engine </a> </li> <li class=md-tabs__item> <a href=../../policies/ class=md-tabs__link> ğŸ¯ Policies & Safety </a> </li> <li class=md-tabs__item> <a href=../../tui/ class=md-tabs__link> ğŸ–¥ï¸ Terminal UI </a> </li> <li class=md-tabs__item> <a href=../../benchmarks/ class=md-tabs__link> ğŸ“Š Benchmarks & Replay </a> </li> <li class=md-tabs__item> <a href=../../observability/ class=md-tabs__link> ğŸ” Observability </a> </li> <li class=md-tabs__item> <a href=../../sandbox/ class=md-tabs__link> ğŸ“¦ Platform </a> </li> <li class=md-tabs__item> <a href=../../reference/ class=md-tabs__link> ğŸ“– Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="RLM Code ğŸ§ª" class="md-nav__button md-logo" aria-label="RLM Code ğŸ§ª" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> RLM Code ğŸ§ª </label> <div class=md-nav__source> <a href=https://github.com/SuperagenticAI/rlm-code title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> SuperagenticAI/rlm-code </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> ğŸ  Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../getting-started/ class="md-nav__link "> <span class=md-ellipsis> ğŸš€ Getting Started </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> ğŸš€ Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/start-here/ class=md-nav__link> <span class=md-ellipsis> ğŸ§­ Start Here </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¦ Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> âš¡ Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/researcher-onboarding/ class=md-nav__link> <span class=md-ellipsis> ğŸ§‘ğŸ”¬ Researcher Onboarding </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/cli/ class=md-nav__link> <span class=md-ellipsis> ğŸ’» CLI Reference </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/configuration/ class=md-nav__link> <span class=md-ellipsis> âš™ï¸ Configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> ğŸ§  Core Engine </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ğŸ§  Core Engine </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../runner/ class=md-nav__link> <span class=md-ellipsis> ğŸ”„ RLM Runner </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> ğŸŒ Environments </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> ğŸŒ Environments </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#environment-protocol class=md-nav__link> <span class=md-ellipsis> Environment Protocol </span> </a> </li> <li class=md-nav__item> <a href=#purerlmenvironment class=md-nav__link> <span class=md-ellipsis> PureRLMEnvironment </span> </a> <nav class=md-nav aria-label=PureRLMEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-innovations class=md-nav__link> <span class=md-ellipsis> Key Innovations </span> </a> </li> <li class=md-nav__item> <a href=#constructor class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#purerlmconfig class=md-nav__link> <span class=md-ellipsis> PureRLMConfig </span> </a> </li> <li class=md-nav__item> <a href=#context-initialization class=md-nav__link> <span class=md-ellipsis> Context Initialization </span> </a> </li> <li class=md-nav__item> <a href=#repl-functions class=md-nav__link> <span class=md-ellipsis> REPL Functions </span> </a> <nav class=md-nav aria-label="REPL Functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#llm_queryprompt-modelnone-str class=md-nav__link> <span class=md-ellipsis> llm_query(prompt, model=None) -&gt; str </span> </a> </li> <li class=md-nav__item> <a href=#llm_query_batchedprompts-modelnone-liststr class=md-nav__link> <span class=md-ellipsis> llm_query_batched(prompts, model=None) -&gt; list[str] </span> </a> </li> <li class=md-nav__item> <a href=#show_vars-str class=md-nav__link> <span class=md-ellipsis> SHOW_VARS() -&gt; str </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#safe-builtins-whitelist class=md-nav__link> <span class=md-ellipsis> Safe Builtins Whitelist </span> </a> </li> <li class=md-nav__item> <a href=#execution-flow class=md-nav__link> <span class=md-ellipsis> Execution Flow </span> </a> </li> <li class=md-nav__item> <a href=#reward-computation class=md-nav__link> <span class=md-ellipsis> Reward Computation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#genericrlmenvironment class=md-nav__link> <span class=md-ellipsis> GenericRLMEnvironment </span> </a> <nav class=md-nav aria-label=GenericRLMEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor_1 class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#supported-actions class=md-nav__link> <span class=md-ellipsis> Supported Actions </span> </a> </li> <li class=md-nav__item> <a href=#system-prompt class=md-nav__link> <span class=md-ellipsis> System Prompt </span> </a> </li> <li class=md-nav__item> <a href=#doctor-checks class=md-nav__link> <span class=md-ellipsis> Doctor Checks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dspycodingrlmenvironment class=md-nav__link> <span class=md-ellipsis> DSPyCodingRLMEnvironment </span> </a> <nav class=md-nav aria-label=DSPyCodingRLMEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-actions_1 class=md-nav__link> <span class=md-ellipsis> Supported Actions </span> </a> </li> <li class=md-nav__item> <a href=#dspy-pattern-matching-bonus class=md-nav__link> <span class=md-ellipsis> DSPy Pattern Matching Bonus </span> </a> </li> <li class=md-nav__item> <a href=#dspy-source-scoring class=md-nav__link> <span class=md-ellipsis> DSPy Source Scoring </span> </a> </li> <li class=md-nav__item> <a href=#verifier-suite class=md-nav__link> <span class=md-ellipsis> Verifier Suite </span> </a> </li> <li class=md-nav__item> <a href=#verifier-reward-calculation class=md-nav__link> <span class=md-ellipsis> Verifier Reward Calculation </span> </a> </li> <li class=md-nav__item> <a href=#doctor-checks-dspy-specific class=md-nav__link> <span class=md-ellipsis> Doctor Checks (DSPy-specific) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common-data-classes class=md-nav__link> <span class=md-ellipsis> Common Data Classes </span> </a> <nav class=md-nav aria-label="Common Data Classes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environmentactionresult class=md-nav__link> <span class=md-ellipsis> EnvironmentActionResult </span> </a> </li> <li class=md-nav__item> <a href=#environmentdoctorcheck class=md-nav__link> <span class=md-ellipsis> EnvironmentDoctorCheck </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rlmrewardprofile class=md-nav__link> <span class=md-ellipsis> RLMRewardProfile </span> </a> <nav class=md-nav aria-label=RLMRewardProfile> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reward-knob-reference class=md-nav__link> <span class=md-ellipsis> Reward Knob Reference </span> </a> </li> <li class=md-nav__item> <a href=#methods class=md-nav__link> <span class=md-ellipsis> Methods </span> </a> </li> <li class=md-nav__item> <a href=#custom-profile-example class=md-nav__link> <span class=md-ellipsis> Custom Profile Example </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../execution-patterns/ class=md-nav__link> <span class=md-ellipsis> ğŸ§­ Execution Patterns </span> </a> </li> <li class=md-nav__item> <a href=../events/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¡ Event System </span> </a> </li> <li class=md-nav__item> <a href=../termination/ class=md-nav__link> <span class=md-ellipsis> ğŸ›‘ Termination </span> </a> </li> <li class=md-nav__item> <a href=../memory-compaction/ class=md-nav__link> <span class=md-ellipsis> ğŸ§¹ Memory Compaction </span> </a> </li> <li class=md-nav__item> <a href=../repl-types/ class=md-nav__link> <span class=md-ellipsis> ğŸ“Ÿ REPL Types </span> </a> </li> <li class=md-nav__item> <a href=../trajectory/ class=md-nav__link> <span class=md-ellipsis> ğŸ“ˆ Trajectory </span> </a> </li> <li class=md-nav__item> <a href=../comparison/ class=md-nav__link> <span class=md-ellipsis> ğŸ”„ Paradigm Comparison </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../policies/ class="md-nav__link "> <span class=md-ellipsis> ğŸ¯ Policies & Safety </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> ğŸ¯ Policies & Safety </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../policies/reward/ class=md-nav__link> <span class=md-ellipsis> ğŸ† Reward Policies </span> </a> </li> <li class=md-nav__item> <a href=../../policies/action-selection/ class=md-nav__link> <span class=md-ellipsis> ğŸ¯ Action Selection </span> </a> </li> <li class=md-nav__item> <a href=../../policies/compaction/ class=md-nav__link> <span class=md-ellipsis> ğŸ§¹ Compaction </span> </a> </li> <li class=md-nav__item> <a href=../../policies/termination/ class=md-nav__link> <span class=md-ellipsis> ğŸ›‘ Termination </span> </a> </li> <li class=md-nav__item> <a href=../../policies/registry/ class=md-nav__link> <span class=md-ellipsis> ğŸ“š Registry </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <div class="md-nav__link md-nav__container"> <a href=../../security/ class="md-nav__link "> <span class=md-ellipsis> ğŸ”’ HITL & Approval </span> </a> <label class="md-nav__link " for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> ğŸ”’ HITL & Approval </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../security/approval-gates/ class=md-nav__link> <span class=md-ellipsis> ğŸ”’ Approval Gates </span> </a> </li> <li class=md-nav__item> <a href=../../security/risk-assessment/ class=md-nav__link> <span class=md-ellipsis> âš ï¸ Risk Assessment </span> </a> </li> <li class=md-nav__item> <a href=../../security/audit/ class=md-nav__link> <span class=md-ellipsis> ğŸ“ Audit Logging </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../tui/ class="md-nav__link "> <span class=md-ellipsis> ğŸ–¥ï¸ Terminal UI </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> ğŸ–¥ï¸ Terminal UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tui/tabs/ class=md-nav__link> <span class=md-ellipsis> ğŸ“‹ Tab Reference </span> </a> </li> <li class=md-nav__item> <a href=../../tui/research/ class=md-nav__link> <span class=md-ellipsis> ğŸ”¬ Research Tab </span> </a> </li> <li class=md-nav__item> <a href=../../tui/widgets/ class=md-nav__link> <span class=md-ellipsis> ğŸ§© Widgets </span> </a> </li> <li class=md-nav__item> <a href=../../tui/theme/ class=md-nav__link> <span class=md-ellipsis> ğŸ¨ Theme System </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../../benchmarks/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“Š Benchmarks & Replay </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> ğŸ“Š Benchmarks & Replay </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../benchmarks/presets/ class=md-nav__link> <span class=md-ellipsis> ğŸ Presets </span> </a> </li> <li class=md-nav__item> <a href=../../benchmarks/leaderboard/ class=md-nav__link> <span class=md-ellipsis> ğŸ† Leaderboard </span> </a> </li> <li class=md-nav__item> <a href=../../benchmarks/session-replay/ class=md-nav__link> <span class=md-ellipsis> âª Session Replay </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <div class="md-nav__link md-nav__container"> <a href=../../observability/ class="md-nav__link "> <span class=md-ellipsis> ğŸ” Observability </span> </a> <label class="md-nav__link " for=__nav_7 id=__nav_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> ğŸ” Observability </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../observability/sinks/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¥ Sink Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../observability/mlflow/ class=md-nav__link> <span class=md-ellipsis> ğŸ“Š MLflow </span> </a> </li> <li class=md-nav__item> <a href=../../observability/otel/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¡ OpenTelemetry </span> </a> </li> <li class=md-nav__item> <a href=../../observability/langsmith/ class=md-nav__link> <span class=md-ellipsis> ğŸ”— LangSmith </span> </a> </li> <li class=md-nav__item> <a href=../../observability/langfuse/ class=md-nav__link> <span class=md-ellipsis> ğŸ”— LangFuse </span> </a> </li> <li class=md-nav__item> <a href=../../observability/logfire/ class=md-nav__link> <span class=md-ellipsis> ğŸ”¥ Logfire </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> ğŸ“¦ Platform </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> ğŸ“¦ Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <div class="md-nav__link md-nav__container"> <a href=../../sandbox/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“¦ Sandbox Runtimes </span> </a> <label class="md-nav__link " for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> ğŸ“¦ Sandbox Runtimes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sandbox/local/ class=md-nav__link> <span class=md-ellipsis> ğŸ’» Local </span> </a> </li> <li class=md-nav__item> <a href=../../sandbox/monty/ class=md-nav__link> <span class=md-ellipsis> ğŸ§¦ Monty </span> </a> </li> <li class=md-nav__item> <a href=../../sandbox/docker/ class=md-nav__link> <span class=md-ellipsis> ğŸ³ Docker </span> </a> </li> <li class=md-nav__item> <a href=../../sandbox/cloud/ class=md-nav__link> <span class=md-ellipsis> â˜ï¸ Cloud </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <div class="md-nav__link md-nav__container"> <a href=../../integrations/ class="md-nav__link "> <span class=md-ellipsis> ğŸ”— Integrations </span> </a> <label class="md-nav__link " for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> ğŸ”— Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../integrations/llm-providers/ class=md-nav__link> <span class=md-ellipsis> ğŸ¤– LLM Providers </span> </a> </li> <li class=md-nav__item> <a href=../../integrations/mcp/ class=md-nav__link> <span class=md-ellipsis> ğŸ”Œ MCP Server </span> </a> </li> <li class=md-nav__item> <a href=../../integrations/frameworks/ class=md-nav__link> <span class=md-ellipsis> ğŸ§© Frameworks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <div class="md-nav__link md-nav__container"> <a href=../../reference/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“– Reference </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> ğŸ“– Reference </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#environment-protocol class=md-nav__link> <span class=md-ellipsis> Environment Protocol </span> </a> </li> <li class=md-nav__item> <a href=#purerlmenvironment class=md-nav__link> <span class=md-ellipsis> PureRLMEnvironment </span> </a> <nav class=md-nav aria-label=PureRLMEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-innovations class=md-nav__link> <span class=md-ellipsis> Key Innovations </span> </a> </li> <li class=md-nav__item> <a href=#constructor class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#purerlmconfig class=md-nav__link> <span class=md-ellipsis> PureRLMConfig </span> </a> </li> <li class=md-nav__item> <a href=#context-initialization class=md-nav__link> <span class=md-ellipsis> Context Initialization </span> </a> </li> <li class=md-nav__item> <a href=#repl-functions class=md-nav__link> <span class=md-ellipsis> REPL Functions </span> </a> <nav class=md-nav aria-label="REPL Functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#llm_queryprompt-modelnone-str class=md-nav__link> <span class=md-ellipsis> llm_query(prompt, model=None) -&gt; str </span> </a> </li> <li class=md-nav__item> <a href=#llm_query_batchedprompts-modelnone-liststr class=md-nav__link> <span class=md-ellipsis> llm_query_batched(prompts, model=None) -&gt; list[str] </span> </a> </li> <li class=md-nav__item> <a href=#show_vars-str class=md-nav__link> <span class=md-ellipsis> SHOW_VARS() -&gt; str </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#safe-builtins-whitelist class=md-nav__link> <span class=md-ellipsis> Safe Builtins Whitelist </span> </a> </li> <li class=md-nav__item> <a href=#execution-flow class=md-nav__link> <span class=md-ellipsis> Execution Flow </span> </a> </li> <li class=md-nav__item> <a href=#reward-computation class=md-nav__link> <span class=md-ellipsis> Reward Computation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#genericrlmenvironment class=md-nav__link> <span class=md-ellipsis> GenericRLMEnvironment </span> </a> <nav class=md-nav aria-label=GenericRLMEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor_1 class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#supported-actions class=md-nav__link> <span class=md-ellipsis> Supported Actions </span> </a> </li> <li class=md-nav__item> <a href=#system-prompt class=md-nav__link> <span class=md-ellipsis> System Prompt </span> </a> </li> <li class=md-nav__item> <a href=#doctor-checks class=md-nav__link> <span class=md-ellipsis> Doctor Checks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dspycodingrlmenvironment class=md-nav__link> <span class=md-ellipsis> DSPyCodingRLMEnvironment </span> </a> <nav class=md-nav aria-label=DSPyCodingRLMEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-actions_1 class=md-nav__link> <span class=md-ellipsis> Supported Actions </span> </a> </li> <li class=md-nav__item> <a href=#dspy-pattern-matching-bonus class=md-nav__link> <span class=md-ellipsis> DSPy Pattern Matching Bonus </span> </a> </li> <li class=md-nav__item> <a href=#dspy-source-scoring class=md-nav__link> <span class=md-ellipsis> DSPy Source Scoring </span> </a> </li> <li class=md-nav__item> <a href=#verifier-suite class=md-nav__link> <span class=md-ellipsis> Verifier Suite </span> </a> </li> <li class=md-nav__item> <a href=#verifier-reward-calculation class=md-nav__link> <span class=md-ellipsis> Verifier Reward Calculation </span> </a> </li> <li class=md-nav__item> <a href=#doctor-checks-dspy-specific class=md-nav__link> <span class=md-ellipsis> Doctor Checks (DSPy-specific) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common-data-classes class=md-nav__link> <span class=md-ellipsis> Common Data Classes </span> </a> <nav class=md-nav aria-label="Common Data Classes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environmentactionresult class=md-nav__link> <span class=md-ellipsis> EnvironmentActionResult </span> </a> </li> <li class=md-nav__item> <a href=#environmentdoctorcheck class=md-nav__link> <span class=md-ellipsis> EnvironmentDoctorCheck </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rlmrewardprofile class=md-nav__link> <span class=md-ellipsis> RLMRewardProfile </span> </a> <nav class=md-nav aria-label=RLMRewardProfile> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reward-knob-reference class=md-nav__link> <span class=md-ellipsis> Reward Knob Reference </span> </a> </li> <li class=md-nav__item> <a href=#methods class=md-nav__link> <span class=md-ellipsis> Methods </span> </a> </li> <li class=md-nav__item> <a href=#custom-profile-example class=md-nav__link> <span class=md-ellipsis> Custom Profile Example </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../.. class=md-path__link> <span class=md-ellipsis> ğŸ  Home </span> </a> </li> <li class=md-path__item> <a href=../ class=md-path__link> <span class=md-ellipsis> ğŸ§  Core Engine </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=environments>Environments<a class=headerlink href=#environments title="Permanent link">&para;</a></h1> <div class="admonition info"> <p class=admonition-title>Modules</p> <p><code>rlm_code.rlm.environments</code> and <code>rlm_code.rlm.pure_rlm_environment</code></p> </div> <p>Environments define how the RLM runner interacts with the LLM and executes actions. Each environment provides its own system prompt, planner prompt construction, action execution logic, reward computation, and health checks.</p> <hr> <h2 id=environment-protocol>Environment Protocol<a class=headerlink href=#environment-protocol title="Permanent link">&para;</a></h2> <p>All environments implement the <code>RLMEnvironment</code> protocol:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>class</span><span class=w> </span><span class=nc>RLMEnvironment</span><span class=p>(</span><span class=n>Protocol</span><span class=p>):</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=k>def</span><span class=w> </span><span class=nf>system_prompt</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>planner_prompt</span><span class=p>(</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>        <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>        <span class=n>memory</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>        <span class=n>trajectory</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]],</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>        <span class=n>step_index</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>execute_action</span><span class=p>(</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>        <span class=n>action</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>        <span class=n>execution_engine</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>        <span class=n>exec_timeout</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        <span class=n>llm_connector</span><span class=p>:</span> <span class=n>Any</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EnvironmentActionResult</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>    <span class=k>def</span><span class=w> </span><span class=nf>doctor_checks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>EnvironmentDoctorCheck</span><span class=p>]:</span> <span class=o>...</span>
</span></code></pre></div> <hr> <h2 id=purerlmenvironment>PureRLMEnvironment<a class=headerlink href=#purerlmenvironment title="Permanent link">&para;</a></h2> <p>The paper-compliant RLM environment implementing exact semantics from "Recursive Language Models" (2025).</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.pure_rlm_environment</span><span class=w> </span><span class=kn>import</span> <span class=n>PureRLMEnvironment</span><span class=p>,</span> <span class=n>PureRLMConfig</span>
</span></code></pre></div> <h3 id=key-innovations>Key Innovations<a class=headerlink href=#key-innovations title="Permanent link">&para;</a></h3> <ol> <li><strong>Context stored as REPL variable</strong> -- not in the token window</li> <li><strong>LLM receives only metadata</strong> -- variable name, type, length, preview</li> <li><strong><code>llm_query()</code></strong> -- enables recursive LLM calls from within code</li> <li><strong><code>llm_query_batched()</code></strong> -- concurrent parallel LLM queries</li> <li><strong><code>SHOW_VARS()</code></strong> -- namespace introspection</li> <li><strong><code>FINAL()</code> / <code>FINAL_VAR()</code></strong> -- clean termination patterns</li> </ol> <h3 id=constructor>Constructor<a class=headerlink href=#constructor title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>class</span><span class=w> </span><span class=nc>PureRLMEnvironment</span><span class=p>:</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>        <span class=n>workdir</span><span class=p>:</span> <span class=n>Path</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>        <span class=n>reward_profile</span><span class=p>:</span> <span class=n>RLMRewardProfile</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>        <span class=n>config</span><span class=p>:</span> <span class=n>PureRLMConfig</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>    <span class=p>):</span>
</span></code></pre></div> <h3 id=purerlmconfig>PureRLMConfig<a class=headerlink href=#purerlmconfig title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nd>@dataclass</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=k>class</span><span class=w> </span><span class=nc>PureRLMConfig</span><span class=p>:</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=n>max_llm_calls</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>50</span>          <span class=c1># Maximum llm_query() calls per run</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=n>max_output_chars</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>20000</span>    <span class=c1># Maximum stdout characters returned</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=n>preview_length</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>500</span>        <span class=c1># Character preview length for variables</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    <span class=n>max_workers</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>8</span>             <span class=c1># Thread pool size for batched queries</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>    <span class=n>sub_model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>     <span class=c1># Override model for sub-LLM calls</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>    <span class=n>sub_provider</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># Override provider for sub-LLM calls</span>
</span></code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>max_llm_calls</code></td> <td><code>50</code></td> <td>Hard limit on <code>llm_query()</code> + <code>llm_query_batched()</code> calls. Raises <code>RuntimeError</code> when exceeded.</td> </tr> <tr> <td><code>max_output_chars</code></td> <td><code>20000</code></td> <td>Truncation limit for stdout in observation</td> </tr> <tr> <td><code>preview_length</code></td> <td><code>500</code></td> <td>Number of characters included in variable preview metadata</td> </tr> <tr> <td><code>max_workers</code></td> <td><code>8</code></td> <td><code>ThreadPoolExecutor</code> worker count for <code>llm_query_batched()</code></td> </tr> <tr> <td><code>sub_model</code></td> <td><code>None</code></td> <td>Model name for sub-LLM calls (falls back to root model)</td> </tr> <tr> <td><code>sub_provider</code></td> <td><code>None</code></td> <td>Provider for sub-LLM calls</td> </tr> </tbody> </table> <h3 id=context-initialization>Context Initialization<a class=headerlink href=#context-initialization title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>env</span> <span class=o>=</span> <span class=n>PureRLMEnvironment</span><span class=p>(</span><span class=n>config</span><span class=o>=</span><span class=n>PureRLMConfig</span><span class=p>(</span><span class=n>preview_length</span><span class=o>=</span><span class=mi>1000</span><span class=p>))</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>env</span><span class=o>.</span><span class=n>initialize_context</span><span class=p>(</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>context</span><span class=o>=</span><span class=n>large_document_text</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>description</span><span class=o>=</span><span class=s2>&quot;Legal contract to analyze&quot;</span><span class=p>,</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=n>additional_vars</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;reference_data&quot;</span><span class=p>:</span> <span class=n>lookup_table</span><span class=p>},</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=p>)</span>
</span></code></pre></div> <p>After initialization, the REPL namespace contains:</p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>context</code></td> <td>Varies</td> <td>The primary input context</td> </tr> <tr> <td><code>FINAL</code></td> <td>Function</td> <td>Direct completion: <code>FINAL(answer)</code></td> </tr> <tr> <td><code>FINAL_VAR</code></td> <td>Function</td> <td>Variable-based completion: <code>FINAL_VAR("result")</code></td> </tr> <tr> <td><code>SHOW_VARS</code></td> <td>Function</td> <td>List all user-defined variables</td> </tr> <tr> <td><code>llm_query</code></td> <td>Function</td> <td>Single recursive LLM call (set after <code>set_llm_connector()</code>)</td> </tr> <tr> <td><code>llm_query_batched</code></td> <td>Function</td> <td>Concurrent batch LLM calls (set after <code>set_llm_connector()</code>)</td> </tr> </tbody> </table> <p>Plus all entries from the safe builtins whitelist.</p> <h3 id=repl-functions>REPL Functions<a class=headerlink href=#repl-functions title="Permanent link">&para;</a></h3> <h4 id=llm_queryprompt-modelnone-str><code>llm_query(prompt, model=None) -&gt; str</code><a class=headerlink href=#llm_queryprompt-modelnone-str title="Permanent link">&para;</a></h4> <p>Query the LLM from within code execution. Each call consumes one unit from the <code>max_llm_calls</code> quota.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Inside REPL code</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>summary</span> <span class=o>=</span> <span class=n>llm_query</span><span class=p>(</span><span class=s2>&quot;Summarize this section:</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>+</span> <span class=n>context</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>5000</span><span class=p>])</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nb>print</span><span class=p>(</span><span class=n>summary</span><span class=p>)</span>
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Call Quota</p> <p>When the call count exceeds <code>max_llm_calls</code>, a <code>RuntimeError</code> is raised with the message: <code>"Exceeded maximum LLM calls (50). Use llm_query_batched for efficiency."</code></p> </div> <h4 id=llm_query_batchedprompts-modelnone-liststr><code>llm_query_batched(prompts, model=None) -&gt; list[str]</code><a class=headerlink href=#llm_query_batchedprompts-modelnone-liststr title="Permanent link">&para;</a></h4> <p>Concurrent batch LLM queries. Significantly faster than sequential <code>llm_query()</code> calls for multiple prompts. Consumes <code>len(prompts)</code> units from the quota.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Inside REPL code</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>chunks</span> <span class=o>=</span> <span class=p>[</span><span class=n>context</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>10000</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>context</span><span class=p>),</span> <span class=mi>10000</span><span class=p>)]</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>prompts</span> <span class=o>=</span> <span class=p>[</span><span class=sa>f</span><span class=s2>&quot;Summarize:</span><span class=se>\n</span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>chunk</span> <span class=ow>in</span> <span class=n>chunks</span><span class=p>]</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=n>summaries</span> <span class=o>=</span> <span class=n>llm_query_batched</span><span class=p>(</span><span class=n>prompts</span><span class=p>)</span>
</span></code></pre></div> <h4 id=show_vars-str><code>SHOW_VARS() -&gt; str</code><a class=headerlink href=#show_vars-str title="Permanent link">&para;</a></h4> <p>List all user-defined variables in the REPL namespace, filtering out builtins and internal functions.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Inside REPL code</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>SHOW_VARS</span><span class=p>()</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=c1># Output:</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1># Available variables:</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1>#   context: str</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=c1>#   summaries: list</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=c1>#   result: dict</span>
</span></code></pre></div> <h3 id=safe-builtins-whitelist>Safe Builtins Whitelist<a class=headerlink href=#safe-builtins-whitelist title="Permanent link">&para;</a></h3> <p>The REPL namespace includes a curated set of safe builtins (approximately 50+ functions):</p> <table> <thead> <tr> <th>Category</th> <th>Functions</th> </tr> </thead> <tbody> <tr> <td><strong>Core types</strong></td> <td><code>True</code>, <code>False</code>, <code>None</code></td> </tr> <tr> <td><strong>Type constructors</strong></td> <td><code>int</code>, <code>float</code>, <code>str</code>, <code>bool</code>, <code>list</code>, <code>dict</code>, <code>tuple</code>, <code>set</code>, <code>frozenset</code>, <code>bytes</code>, <code>bytearray</code></td> </tr> <tr> <td><strong>Iterables</strong></td> <td><code>range</code>, <code>enumerate</code>, <code>zip</code>, <code>map</code>, <code>filter</code>, <code>sorted</code>, <code>reversed</code>, <code>iter</code>, <code>next</code></td> </tr> <tr> <td><strong>Math/comparison</strong></td> <td><code>len</code>, <code>min</code>, <code>max</code>, <code>sum</code>, <code>abs</code>, <code>round</code>, <code>pow</code>, <code>divmod</code></td> </tr> <tr> <td><strong>String/char</strong></td> <td><code>chr</code>, <code>ord</code>, <code>repr</code>, <code>ascii</code>, <code>format</code></td> </tr> <tr> <td><strong>Type checking</strong></td> <td><code>type</code>, <code>isinstance</code>, <code>issubclass</code>, <code>hasattr</code>, <code>getattr</code>, <code>setattr</code>, <code>delattr</code>, <code>callable</code></td> </tr> <tr> <td><strong>Collections</strong></td> <td><code>all</code>, <code>any</code>, <code>slice</code></td> </tr> <tr> <td><strong>IO</strong></td> <td><code>print</code>, <code>open</code></td> </tr> <tr> <td><strong>Import</strong></td> <td><code>__import__</code> (required for standard library access)</td> </tr> <tr> <td><strong>Exceptions</strong></td> <td><code>Exception</code>, <code>ValueError</code>, <code>TypeError</code>, <code>KeyError</code>, <code>IndexError</code>, <code>AttributeError</code>, <code>RuntimeError</code>, <code>StopIteration</code></td> </tr> </tbody> </table> <div class="admonition danger"> <p class=admonition-title>Blocked Functions</p> <p>The following are intentionally excluded: <code>eval</code>, <code>exec</code>, <code>compile</code>, <code>input</code>, <code>globals</code>, <code>locals</code>.</p> </div> <h3 id=execution-flow>Execution Flow<a class=headerlink href=#execution-flow title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>initialize_context(data) --&gt; set_llm_connector(connector) --&gt; execute_action(action)
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>                                                                    |
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>                                                            +-------v-------+
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>                                                            | Extract code  |
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>                                                            | from action   |
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>                                                            +-------+-------+
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>                                                                    |
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>                                                            +-------v-------+
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>                                                            | exec(code,    |
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>                                                            |   namespace)  |
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>                                                            +-------+-------+
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>                                                                    |
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>                                                        +-----------+-----------+
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>                                                        |                       |
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>                                                 FinalOutput?              Normal result
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>                                                        |                       |
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>                                                 +------v------+        +-------v-------+
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>                                                 | Resolve     |        | Compute reward|
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>                                                 | FINAL/      |        | Update history|
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>                                                 | FINAL_VAR   |        | Return result |
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>                                                 +-------------+        +---------------+
</span></code></pre></div> <h3 id=reward-computation>Reward Computation<a class=headerlink href=#reward-computation title="Permanent link">&para;</a></h3> <p>The Pure RLM environment computes rewards as:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>reward</span> <span class=o>=</span> <span class=n>run_python_base</span>                      <span class=c1># 0.1</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>if</span> <span class=n>success</span><span class=p>:</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>reward</span> <span class=o>+=</span> <span class=n>run_python_success_bonus</span>        <span class=c1># +0.7</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=k>else</span><span class=p>:</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>reward</span> <span class=o>-=</span> <span class=n>run_python_failure_penalty</span>      <span class=c1># -0.3</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=k>if</span> <span class=n>stderr</span><span class=p>:</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=n>reward</span> <span class=o>-=</span> <span class=n>run_python_stderr_penalty</span>       <span class=c1># -0.1</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=k>if</span> <span class=n>llm_calls_made</span><span class=p>:</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    <span class=n>reward</span> <span class=o>+=</span> <span class=mf>0.1</span> <span class=o>*</span> <span class=nb>min</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>llm_calls</span><span class=p>),</span> <span class=mi>5</span><span class=p>)</span>   <span class=c1># Bonus for using RLM paradigm</span>
</span></code></pre></div> <hr> <h2 id=genericrlmenvironment>GenericRLMEnvironment<a class=headerlink href=#genericrlmenvironment title="Permanent link">&para;</a></h2> <p>A general-purpose environment supporting <code>run_python</code> and <code>final</code> actions.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.environments</span><span class=w> </span><span class=kn>import</span> <span class=n>GenericRLMEnvironment</span>
</span></code></pre></div> <h3 id=constructor_1>Constructor<a class=headerlink href=#constructor_1 title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>class</span><span class=w> </span><span class=nc>GenericRLMEnvironment</span><span class=p>:</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;generic&quot;</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>        <span class=n>workdir</span><span class=p>:</span> <span class=n>Path</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>        <span class=n>reward_profile</span><span class=p>:</span> <span class=n>RLMRewardProfile</span> <span class=o>|</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=p>):</span>
</span></code></pre></div> <h3 id=supported-actions>Supported Actions<a class=headerlink href=#supported-actions title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Action</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>run_python</code></td> <td>Execute Python code in the sandbox</td> </tr> <tr> <td><code>final</code></td> <td>Signal task completion with <code>final_response</code></td> </tr> </tbody> </table> <h3 id=system-prompt>System Prompt<a class=headerlink href=#system-prompt title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>You are an RLM planner.
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>Return ONLY valid JSON with keys: action, code, rationale, done, final_response.
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>Valid action values: &quot;run_python&quot;, &quot;final&quot;.
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>No markdown. JSON only.
</span></code></pre></div> <h3 id=doctor-checks>Doctor Checks<a class=headerlink href=#doctor-checks title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Check</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>workdir_exists</code></td> <td>Working directory exists</td> </tr> <tr> <td><code>workdir_writable</code></td> <td>Write access to working directory</td> </tr> <tr> <td><code>python_runtime</code></td> <td>Python executable path</td> </tr> </tbody> </table> <hr> <h2 id=dspycodingrlmenvironment>DSPyCodingRLMEnvironment<a class=headerlink href=#dspycodingrlmenvironment title="Permanent link">&para;</a></h2> <p>Extends <code>GenericRLMEnvironment</code> with DSPy-specific features, file operations, code search, test execution, and DSPy-aware scoring.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.environments</span><span class=w> </span><span class=kn>import</span> <span class=n>DSPyCodingRLMEnvironment</span>
</span></code></pre></div> <h3 id=supported-actions_1>Supported Actions<a class=headerlink href=#supported-actions_1 title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Action</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>run_python</code></td> <td>Execute Python code (with DSPy pattern bonus)</td> </tr> <tr> <td><code>write_file</code></td> <td>Write content to a file with verifier suite</td> </tr> <tr> <td><code>patch_file</code></td> <td>Search-and-replace or full content patch</td> </tr> <tr> <td><code>read_file</code></td> <td>Read file content with line range support</td> </tr> <tr> <td><code>search_code</code></td> <td>Regex-based code search across files</td> </tr> <tr> <td><code>list_tree</code></td> <td>Directory tree listing</td> </tr> <tr> <td><code>run_tests</code></td> <td>Execute pytest commands</td> </tr> <tr> <td><code>analyze_code</code> / <code>analyze_dspy</code></td> <td>Score code quality with DSPy heuristics</td> </tr> <tr> <td><code>llm_query</code></td> <td>Single sub-LLM query</td> </tr> <tr> <td><code>llm_query_batched</code></td> <td>Batch sub-LLM queries</td> </tr> <tr> <td><code>delegate</code> / <code>delegate_batch</code></td> <td>Recursive subtask delegation</td> </tr> <tr> <td><code>final</code></td> <td>Signal task completion</td> </tr> </tbody> </table> <h3 id=dspy-pattern-matching-bonus>DSPy Pattern Matching Bonus<a class=headerlink href=#dspy-pattern-matching-bonus title="Permanent link">&para;</a></h3> <p>When <code>run_python</code> is executed, the code is scanned for DSPy patterns:</p> <table> <thead> <tr> <th>Pattern</th> <th>Regex</th> <th>Bonus</th> </tr> </thead> <tbody> <tr> <td>DSPy import</td> <td><code>\bimport\s+dspy\b</code></td> <td><code>+0.03</code></td> </tr> <tr> <td>Signature class</td> <td><code>\bdspy\.Signature\b</code></td> <td><code>+0.03</code></td> </tr> <tr> <td>InputField</td> <td><code>\bdspy\.InputField\b</code></td> <td><code>+0.03</code></td> </tr> <tr> <td>OutputField</td> <td><code>\bdspy\.OutputField\b</code></td> <td><code>+0.03</code></td> </tr> <tr> <td>Module class</td> <td><code>\bdspy\.Module\b</code></td> <td><code>+0.03</code></td> </tr> <tr> <td><code>forward()</code> method</td> <td><code>\bdef\s+forward\s*\(</code></td> <td><code>+0.03</code></td> </tr> </tbody> </table> <p>Total bonus is capped at <code>dspy_pattern_bonus_cap</code> (default: <code>0.2</code>).</p> <h3 id=dspy-source-scoring>DSPy Source Scoring<a class=headerlink href=#dspy-source-scoring title="Permanent link">&para;</a></h3> <p>Files written with <code>write_file</code> or <code>patch_file</code> are scored on a 0-100 scale:</p> <table> <thead> <tr> <th>Pattern</th> <th>Score Contribution</th> </tr> </thead> <tbody> <tr> <td>Base score</td> <td><code>35.0</code></td> </tr> <tr> <td><code>import dspy</code></td> <td><code>+10.0</code></td> </tr> <tr> <td><code>class X(dspy.Signature):</code></td> <td><code>+15.0</code></td> </tr> <tr> <td><code>dspy.InputField(</code></td> <td><code>+10.0</code></td> </tr> <tr> <td><code>dspy.OutputField(</code></td> <td><code>+10.0</code></td> </tr> <tr> <td><code>class X(dspy.Module):</code></td> <td><code>+10.0</code></td> </tr> <tr> <td><code>def forward(</code></td> <td><code>+10.0</code></td> </tr> <tr> <td><code>dspy.settings.configure</code></td> <td><code>-8.0</code> (deprecated pattern)</td> </tr> <tr> <td><code>dspy.OpenAI(</code> / <code>dspy.Anthropic(</code></td> <td><code>-8.0</code> (hardcoded provider)</td> </tr> <tr> <td><code>TODO</code></td> <td><code>-4.0</code></td> </tr> </tbody> </table> <h3 id=verifier-suite>Verifier Suite<a class=headerlink href=#verifier-suite title="Permanent link">&para;</a></h3> <p>After <code>write_file</code> and <code>patch_file</code>, a three-stage verifier runs:</p> <ol> <li><strong>Compile check</strong> -- <code>python -m compileall</code> for syntax validation</li> <li><strong>Targeted pytest</strong> -- runs matching <code>test_&lt;stem&gt;.py</code> if it exists</li> <li><strong>Code validation</strong> -- DSPy-oriented validator from the execution engine</li> </ol> <h3 id=verifier-reward-calculation>Verifier Reward Calculation<a class=headerlink href=#verifier-reward-calculation title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>reward</span> <span class=o>=</span> <span class=n>verifier_base</span> <span class=o>+</span> <span class=p>(</span><span class=n>dspy_score</span> <span class=o>/</span> <span class=mf>100.0</span><span class=p>)</span> <span class=o>*</span> <span class=n>verifier_score_weight</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>if</span> <span class=n>compile_ok</span><span class=p>:</span>    <span class=n>reward</span> <span class=o>+=</span> <span class=n>verifier_compile_bonus</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=k>else</span><span class=p>:</span>             <span class=n>reward</span> <span class=o>-=</span> <span class=n>verifier_compile_penalty</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=k>if</span> <span class=n>pytest_ran</span><span class=p>:</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>    <span class=k>if</span> <span class=n>pytest_ok</span><span class=p>:</span> <span class=n>reward</span> <span class=o>+=</span> <span class=n>verifier_pytest_bonus</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=k>else</span><span class=p>:</span>         <span class=n>reward</span> <span class=o>-=</span> <span class=n>verifier_pytest_penalty</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=k>if</span> <span class=n>validation_ok</span><span class=p>:</span> <span class=n>reward</span> <span class=o>+=</span> <span class=n>verifier_validation_bonus</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=k>else</span><span class=p>:</span>             <span class=n>reward</span> <span class=o>-=</span> <span class=n>verifier_validation_penalty</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=n>reward</span> <span class=o>-=</span> <span class=nb>min</span><span class=p>(</span><span class=n>warning_penalty_cap</span><span class=p>,</span> <span class=n>num_warnings</span> <span class=o>*</span> <span class=n>warning_penalty_per_warning</span><span class=p>)</span>
</span></code></pre></div> <h3 id=doctor-checks-dspy-specific>Doctor Checks (DSPy-specific)<a class=headerlink href=#doctor-checks-dspy-specific title="Permanent link">&para;</a></h3> <p>All generic checks plus:</p> <table> <thead> <tr> <th>Check</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>pytest_cli</code></td> <td>pytest available on PATH</td> </tr> <tr> <td><code>test_discovery</code></td> <td>Test files found in <code>tests/</code></td> </tr> <tr> <td><code>dspy_import</code></td> <td><code>import dspy</code> succeeds</td> </tr> </tbody> </table> <hr> <h2 id=common-data-classes>Common Data Classes<a class=headerlink href=#common-data-classes title="Permanent link">&para;</a></h2> <h3 id=environmentactionresult><code>EnvironmentActionResult</code><a class=headerlink href=#environmentactionresult title="Permanent link">&para;</a></h3> <p>Returned by every <code>execute_action()</code> call.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nd>@dataclass</span><span class=p>(</span><span class=n>slots</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=k>class</span><span class=w> </span><span class=nc>EnvironmentActionResult</span><span class=p>:</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>observation</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>       <span class=c1># Execution output visible to the LLM</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>reward</span><span class=p>:</span> <span class=nb>float</span>                     <span class=c1># Scalar reward in [-1.0, 1.0]</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    <span class=n>done</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>                <span class=c1># True if task is complete</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=n>final_response</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1># Final answer (when done=True)</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=n>memory_note</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>    <span class=c1># Short note for rolling memory</span>
</span></code></pre></div> <h3 id=environmentdoctorcheck><code>EnvironmentDoctorCheck</code><a class=headerlink href=#environmentdoctorcheck title="Permanent link">&para;</a></h3> <p>Health check result from <code>doctor_checks()</code>.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nd>@dataclass</span><span class=p>(</span><span class=n>slots</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>class</span><span class=w> </span><span class=nc>EnvironmentDoctorCheck</span><span class=p>:</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>                          <span class=c1># Check identifier</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>status</span><span class=p>:</span> <span class=nb>str</span>                        <span class=c1># &quot;pass&quot; | &quot;warn&quot; | &quot;fail&quot;</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=n>detail</span><span class=p>:</span> <span class=nb>str</span>                        <span class=c1># Human-readable description</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>    <span class=n>recommendation</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># Fix suggestion (if not passing)</span>
</span></code></pre></div> <hr> <h2 id=rlmrewardprofile>RLMRewardProfile<a class=headerlink href=#rlmrewardprofile title="Permanent link">&para;</a></h2> <p>The reward tuning profile with 25+ configurable knobs.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nd>@dataclass</span><span class=p>(</span><span class=n>slots</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=k>class</span><span class=w> </span><span class=nc>RLMRewardProfile</span><span class=p>:</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=c1># Global multiplier</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=n>global_scale</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>    <span class=c1># run_python scoring</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>    <span class=n>run_python_base</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.1</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>    <span class=n>run_python_success_bonus</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.7</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>    <span class=n>run_python_failure_penalty</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.3</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>    <span class=n>run_python_stderr_penalty</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.1</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>    <span class=c1># DSPy heuristic adjustments</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>    <span class=n>dspy_pattern_match_bonus</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.03</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>    <span class=n>dspy_pattern_bonus_cap</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.2</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>    <span class=c1># Verifier scoring</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>    <span class=n>verifier_base</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.15</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a>    <span class=n>verifier_score_weight</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.5</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a>    <span class=n>verifier_compile_bonus</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.2</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a>    <span class=n>verifier_compile_penalty</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.35</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>    <span class=n>verifier_pytest_bonus</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.25</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a>    <span class=n>verifier_pytest_penalty</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.25</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a>    <span class=n>verifier_validation_bonus</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.15</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a>    <span class=n>verifier_validation_penalty</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.3</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a>    <span class=n>verifier_warning_penalty_per_warning</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.03</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>    <span class=n>verifier_warning_penalty_cap</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.15</span>
</span></code></pre></div> <h3 id=reward-knob-reference>Reward Knob Reference<a class=headerlink href=#reward-knob-reference title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Knob</th> <th>Default</th> <th>Category</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>global_scale</code></td> <td><code>1.0</code></td> <td>Global</td> <td>Multiplier applied to all rewards after environment calculation</td> </tr> <tr> <td><code>run_python_base</code></td> <td><code>0.1</code></td> <td>Execution</td> <td>Base reward for any code execution</td> </tr> <tr> <td><code>run_python_success_bonus</code></td> <td><code>0.7</code></td> <td>Execution</td> <td>Added on successful execution</td> </tr> <tr> <td><code>run_python_failure_penalty</code></td> <td><code>0.3</code></td> <td>Execution</td> <td>Subtracted on execution failure</td> </tr> <tr> <td><code>run_python_stderr_penalty</code></td> <td><code>0.1</code></td> <td>Execution</td> <td>Subtracted when stderr is non-empty</td> </tr> <tr> <td><code>dspy_pattern_match_bonus</code></td> <td><code>0.03</code></td> <td>DSPy</td> <td>Per-pattern bonus for DSPy idioms</td> </tr> <tr> <td><code>dspy_pattern_bonus_cap</code></td> <td><code>0.2</code></td> <td>DSPy</td> <td>Maximum total DSPy pattern bonus</td> </tr> <tr> <td><code>verifier_base</code></td> <td><code>0.15</code></td> <td>Verifier</td> <td>Base reward for file write/patch</td> </tr> <tr> <td><code>verifier_score_weight</code></td> <td><code>0.5</code></td> <td>Verifier</td> <td>Weight of DSPy source score (0-100 mapped to 0-0.5)</td> </tr> <tr> <td><code>verifier_compile_bonus</code></td> <td><code>0.2</code></td> <td>Verifier</td> <td>Bonus for passing compile check</td> </tr> <tr> <td><code>verifier_compile_penalty</code></td> <td><code>0.35</code></td> <td>Verifier</td> <td>Penalty for failing compile check</td> </tr> <tr> <td><code>verifier_pytest_bonus</code></td> <td><code>0.25</code></td> <td>Verifier</td> <td>Bonus for passing targeted tests</td> </tr> <tr> <td><code>verifier_pytest_penalty</code></td> <td><code>0.25</code></td> <td>Verifier</td> <td>Penalty for failing targeted tests</td> </tr> <tr> <td><code>verifier_validation_bonus</code></td> <td><code>0.15</code></td> <td>Verifier</td> <td>Bonus for passing code validation</td> </tr> <tr> <td><code>verifier_validation_penalty</code></td> <td><code>0.3</code></td> <td>Verifier</td> <td>Penalty for failing code validation</td> </tr> <tr> <td><code>verifier_warning_penalty_per_warning</code></td> <td><code>0.03</code></td> <td>Verifier</td> <td>Per-warning penalty</td> </tr> <tr> <td><code>verifier_warning_penalty_cap</code></td> <td><code>0.15</code></td> <td>Verifier</td> <td>Maximum total warning penalty</td> </tr> </tbody> </table> <h3 id=methods>Methods<a class=headerlink href=#methods title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Method</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>from_mapping(payload)</code></td> <td>Class method to build profile from dict with safe fallbacks</td> </tr> <tr> <td><code>clamp(value)</code></td> <td>Static method to clamp reward to <code>[-1.0, 1.0]</code></td> </tr> <tr> <td><code>apply_global_scale(value)</code></td> <td>Apply global scaling and clamp</td> </tr> </tbody> </table> <h3 id=custom-profile-example>Custom Profile Example<a class=headerlink href=#custom-profile-example title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.environments</span><span class=w> </span><span class=kn>import</span> <span class=n>RLMRewardProfile</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1># Aggressive profile favoring correctness over speed</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=n>profile</span> <span class=o>=</span> <span class=n>RLMRewardProfile</span><span class=p>(</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    <span class=n>global_scale</span><span class=o>=</span><span class=mf>1.2</span><span class=p>,</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>    <span class=n>run_python_success_bonus</span><span class=o>=</span><span class=mf>0.9</span><span class=p>,</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>    <span class=n>run_python_failure_penalty</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>    <span class=n>verifier_compile_penalty</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>    <span class=n>verifier_pytest_bonus</span><span class=o>=</span><span class=mf>0.4</span><span class=p>,</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=p>)</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=c1># Or from a dictionary (e.g., loaded from config)</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=n>profile</span> <span class=o>=</span> <span class=n>RLMRewardProfile</span><span class=o>.</span><span class=n>from_mapping</span><span class=p>({</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>    <span class=s2>&quot;global_scale&quot;</span><span class=p>:</span> <span class=mf>1.2</span><span class=p>,</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>    <span class=s2>&quot;run_python_success_bonus&quot;</span><span class=p>:</span> <span class=mf>0.9</span><span class=p>,</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=p>})</span>
</span></code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Brought to You by <a href=https://super-agentic.ai target=_blank rel=noopener>Superagentic AI</a> </div> </div> <div class=md-social> <a href=https://github.com/SuperagenticAI/rlm-code target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://pypi.org/project/rlm-code/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>