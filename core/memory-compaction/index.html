<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ğŸš€ Research Playground & Evaluation OS for Recursive Language Model Agentic Systems"><meta name=author content="Shashi Jagtap"><link href=https://superagenticai.github.io/rlm-code/core/memory-compaction/ rel=canonical><link href=../termination/ rel=prev><link href=../repl-types/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>ğŸ§¹ Memory Compaction - RLM Code ğŸ§ª</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#memory-compaction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="RLM Code ğŸ§ª" class="md-header__button md-logo" aria-label="RLM Code ğŸ§ª" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> RLM Code ğŸ§ª </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ğŸ§¹ Memory Compaction </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=purple aria-label="â˜€ï¸ Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="â˜€ï¸ Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=purple aria-label="ğŸŒ™ Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="ğŸŒ™ Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/SuperagenticAI/rlm-code title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> SuperagenticAI/rlm-code </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> ğŸ  Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> ğŸš€ Getting Started </a> </li> <li class=md-tabs__item> <a href=../../codemode/ class=md-tabs__link> ğŸ§ª CodeMode </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> ğŸ§  Core Engine </a> </li> <li class=md-tabs__item> <a href=../../policies/ class=md-tabs__link> ğŸ¯ Policies & Safety </a> </li> <li class=md-tabs__item> <a href=../../tui/ class=md-tabs__link> ğŸ–¥ï¸ Terminal UI </a> </li> <li class=md-tabs__item> <a href=../../benchmarks/ class=md-tabs__link> ğŸ“Š Benchmarks & Replay </a> </li> <li class=md-tabs__item> <a href=../../observability/ class=md-tabs__link> ğŸ” Observability </a> </li> <li class=md-tabs__item> <a href=../../sandbox/ class=md-tabs__link> ğŸ“¦ Platform </a> </li> <li class=md-tabs__item> <a href=../../reference/ class=md-tabs__link> ğŸ“– Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="RLM Code ğŸ§ª" class="md-nav__button md-logo" aria-label="RLM Code ğŸ§ª" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> RLM Code ğŸ§ª </label> <div class=md-nav__source> <a href=https://github.com/SuperagenticAI/rlm-code title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> SuperagenticAI/rlm-code </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> ğŸ  Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../getting-started/ class="md-nav__link "> <span class=md-ellipsis> ğŸš€ Getting Started </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> ğŸš€ Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/start-here/ class=md-nav__link> <span class=md-ellipsis> ğŸ§­ Start Here </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¦ Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> âš¡ Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/codemode-quickstart/ class=md-nav__link> <span class=md-ellipsis> ğŸ§ª CodeMode Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/researcher-onboarding/ class=md-nav__link> <span class=md-ellipsis> ğŸ§‘ğŸ”¬ Researcher Onboarding </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/cli/ class=md-nav__link> <span class=md-ellipsis> ğŸ’» CLI Reference </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/configuration/ class=md-nav__link> <span class=md-ellipsis> âš™ï¸ Configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../codemode/ class="md-nav__link "> <span class=md-ellipsis> ğŸ§ª CodeMode </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ğŸ§ª CodeMode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../codemode/quickstart/ class=md-nav__link> <span class=md-ellipsis> âš¡ Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../../codemode/utcp/ class=md-nav__link> <span class=md-ellipsis> ğŸ”§ UTCP (Local) </span> </a> </li> <li class=md-nav__item> <a href=../../codemode/cloudflare/ class=md-nav__link> <span class=md-ellipsis> â˜ï¸ Cloudflare (Remote) </span> </a> </li> <li class=md-nav__item> <a href=../../codemode/architecture/ class=md-nav__link> <span class=md-ellipsis> ğŸ—ï¸ Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../codemode/guardrails/ class=md-nav__link> <span class=md-ellipsis> ğŸ›¡ï¸ Guardrails </span> </a> </li> <li class=md-nav__item> <a href=../../codemode/evaluation/ class=md-nav__link> <span class=md-ellipsis> âš–ï¸ Evaluation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> ğŸ§  Core Engine </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> ğŸ§  Core Engine </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../runner/ class=md-nav__link> <span class=md-ellipsis> ğŸ”„ RLM Runner </span> </a> </li> <li class=md-nav__item> <a href=../environments/ class=md-nav__link> <span class=md-ellipsis> ğŸŒ Environments </span> </a> </li> <li class=md-nav__item> <a href=../execution-patterns/ class=md-nav__link> <span class=md-ellipsis> ğŸ§­ Execution Patterns </span> </a> </li> <li class=md-nav__item> <a href=../events/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¡ Event System </span> </a> </li> <li class=md-nav__item> <a href=../termination/ class=md-nav__link> <span class=md-ellipsis> ğŸ›‘ Termination </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> ğŸ§¹ Memory Compaction </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> ğŸ§¹ Memory Compaction </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#classes class=md-nav__link> <span class=md-ellipsis> Classes </span> </a> <nav class=md-nav aria-label=Classes> <ul class=md-nav__list> <li class=md-nav__item> <a href=#compactionconfig class=md-nav__link> <span class=md-ellipsis> CompactionConfig </span> </a> <nav class=md-nav aria-label=CompactionConfig> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuration-fields class=md-nav__link> <span class=md-ellipsis> Configuration Fields </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#compactionresult class=md-nav__link> <span class=md-ellipsis> CompactionResult </span> </a> <nav class=md-nav aria-label=CompactionResult> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fields class=md-nav__link> <span class=md-ellipsis> Fields </span> </a> </li> <li class=md-nav__item> <a href=#properties class=md-nav__link> <span class=md-ellipsis> Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#memorycompactor class=md-nav__link> <span class=md-ellipsis> MemoryCompactor </span> </a> <nav class=md-nav aria-label=MemoryCompactor> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#methods class=md-nav__link> <span class=md-ellipsis> Methods </span> </a> <nav class=md-nav aria-label=Methods> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set_llm_connectorconnector class=md-nav__link> <span class=md-ellipsis> set_llm_connector(connector) </span> </a> </li> <li class=md-nav__item> <a href=#should_compacthistory class=md-nav__link> <span class=md-ellipsis> should_compact(history) </span> </a> </li> <li class=md-nav__item> <a href=#compacthistory-task-forcefalse class=md-nav__link> <span class=md-ellipsis> compact(history, task="", force=False) </span> </a> </li> <li class=md-nav__item> <a href=#apply_compactionhistory-compaction_result class=md-nav__link> <span class=md-ellipsis> apply_compaction(history, compaction_result) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#entry-preservation-strategy class=md-nav__link> <span class=md-ellipsis> Entry Preservation Strategy </span> </a> </li> <li class=md-nav__item> <a href=#summarization-strategies class=md-nav__link> <span class=md-ellipsis> Summarization Strategies </span> </a> <nav class=md-nav aria-label="Summarization Strategies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#llm-based-summarization class=md-nav__link> <span class=md-ellipsis> LLM-Based Summarization </span> </a> </li> <li class=md-nav__item> <a href=#deterministic-summarization class=md-nav__link> <span class=md-ellipsis> Deterministic Summarization </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conversationmemory class=md-nav__link> <span class=md-ellipsis> ConversationMemory </span> </a> <nav class=md-nav aria-label=ConversationMemory> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor_1 class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#methods_1 class=md-nav__link> <span class=md-ellipsis> Methods </span> </a> </li> <li class=md-nav__item> <a href=#context-format class=md-nav__link> <span class=md-ellipsis> Context Format </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#end-to-end-example class=md-nav__link> <span class=md-ellipsis> End-to-End Example </span> </a> </li> <li class=md-nav__item> <a href=#configuration-recipes class=md-nav__link> <span class=md-ellipsis> Configuration Recipes </span> </a> <nav class=md-nav aria-label="Configuration Recipes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#high-throughput-benchmarks class=md-nav__link> <span class=md-ellipsis> High-Throughput Benchmarks </span> </a> </li> <li class=md-nav__item> <a href=#long-running-research-sessions class=md-nav__link> <span class=md-ellipsis> Long-Running Research Sessions </span> </a> </li> <li class=md-nav__item> <a href=#minimal-memory-small-context-window-models class=md-nav__link> <span class=md-ellipsis> Minimal Memory (Small Context Window Models) </span> </a> </li> <li class=md-nav__item> <a href=#no-compaction-large-context-window-models class=md-nav__link> <span class=md-ellipsis> No Compaction (Large Context Window Models) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../repl-types/ class=md-nav__link> <span class=md-ellipsis> ğŸ“Ÿ REPL Types </span> </a> </li> <li class=md-nav__item> <a href=../trajectory/ class=md-nav__link> <span class=md-ellipsis> ğŸ“ˆ Trajectory </span> </a> </li> <li class=md-nav__item> <a href=../comparison/ class=md-nav__link> <span class=md-ellipsis> ğŸ”„ Paradigm Comparison </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../policies/ class="md-nav__link "> <span class=md-ellipsis> ğŸ¯ Policies & Safety </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> ğŸ¯ Policies & Safety </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../policies/reward/ class=md-nav__link> <span class=md-ellipsis> ğŸ† Reward Policies </span> </a> </li> <li class=md-nav__item> <a href=../../policies/action-selection/ class=md-nav__link> <span class=md-ellipsis> ğŸ¯ Action Selection </span> </a> </li> <li class=md-nav__item> <a href=../../policies/compaction/ class=md-nav__link> <span class=md-ellipsis> ğŸ§¹ Compaction </span> </a> </li> <li class=md-nav__item> <a href=../../policies/termination/ class=md-nav__link> <span class=md-ellipsis> ğŸ›‘ Termination </span> </a> </li> <li class=md-nav__item> <a href=../../policies/registry/ class=md-nav__link> <span class=md-ellipsis> ğŸ“š Registry </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <div class="md-nav__link md-nav__container"> <a href=../../security/ class="md-nav__link "> <span class=md-ellipsis> ğŸ”’ HITL & Approval </span> </a> <label class="md-nav__link " for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> ğŸ”’ HITL & Approval </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../security/approval-gates/ class=md-nav__link> <span class=md-ellipsis> ğŸ”’ Approval Gates </span> </a> </li> <li class=md-nav__item> <a href=../../security/codemode-guardrails/ class=md-nav__link> <span class=md-ellipsis> ğŸ›¡ï¸ CodeMode Guardrails </span> </a> </li> <li class=md-nav__item> <a href=../../security/risk-assessment/ class=md-nav__link> <span class=md-ellipsis> âš ï¸ Risk Assessment </span> </a> </li> <li class=md-nav__item> <a href=../../security/audit/ class=md-nav__link> <span class=md-ellipsis> ğŸ“ Audit Logging </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../../tui/ class="md-nav__link "> <span class=md-ellipsis> ğŸ–¥ï¸ Terminal UI </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> ğŸ–¥ï¸ Terminal UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tui/tabs/ class=md-nav__link> <span class=md-ellipsis> ğŸ“‹ Tab Reference </span> </a> </li> <li class=md-nav__item> <a href=../../tui/research/ class=md-nav__link> <span class=md-ellipsis> ğŸ”¬ Research Tab </span> </a> </li> <li class=md-nav__item> <a href=../../tui/widgets/ class=md-nav__link> <span class=md-ellipsis> ğŸ§© Widgets </span> </a> </li> <li class=md-nav__item> <a href=../../tui/theme/ class=md-nav__link> <span class=md-ellipsis> ğŸ¨ Theme System </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <div class="md-nav__link md-nav__container"> <a href=../../benchmarks/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“Š Benchmarks & Replay </span> </a> <label class="md-nav__link " for=__nav_7 id=__nav_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> ğŸ“Š Benchmarks & Replay </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../benchmarks/presets/ class=md-nav__link> <span class=md-ellipsis> ğŸ Presets </span> </a> </li> <li class=md-nav__item> <a href=../../benchmarks/leaderboard/ class=md-nav__link> <span class=md-ellipsis> ğŸ† Leaderboard </span> </a> </li> <li class=md-nav__item> <a href=../../benchmarks/codemode-evaluation/ class=md-nav__link> <span class=md-ellipsis> âš–ï¸ CodeMode Evaluation </span> </a> </li> <li class=md-nav__item> <a href=../../benchmarks/session-replay/ class=md-nav__link> <span class=md-ellipsis> âª Session Replay </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <div class="md-nav__link md-nav__container"> <a href=../../observability/ class="md-nav__link "> <span class=md-ellipsis> ğŸ” Observability </span> </a> <label class="md-nav__link " for=__nav_8 id=__nav_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> ğŸ” Observability </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../observability/sinks/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¥ Sink Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../observability/mlflow/ class=md-nav__link> <span class=md-ellipsis> ğŸ“Š MLflow </span> </a> </li> <li class=md-nav__item> <a href=../../observability/otel/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¡ OpenTelemetry </span> </a> </li> <li class=md-nav__item> <a href=../../observability/langsmith/ class=md-nav__link> <span class=md-ellipsis> ğŸ”— LangSmith </span> </a> </li> <li class=md-nav__item> <a href=../../observability/langfuse/ class=md-nav__link> <span class=md-ellipsis> ğŸ”— LangFuse </span> </a> </li> <li class=md-nav__item> <a href=../../observability/logfire/ class=md-nav__link> <span class=md-ellipsis> ğŸ”¥ Logfire </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> ğŸ“¦ Platform </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> ğŸ“¦ Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_1> <div class="md-nav__link md-nav__container"> <a href=../../sandbox/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“¦ Sandbox Runtimes </span> </a> <label class="md-nav__link " for=__nav_9_1 id=__nav_9_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_1_label aria-expanded=false> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> ğŸ“¦ Sandbox Runtimes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sandbox/local/ class=md-nav__link> <span class=md-ellipsis> ğŸ’» Local </span> </a> </li> <li class=md-nav__item> <a href=../../sandbox/monty/ class=md-nav__link> <span class=md-ellipsis> ğŸ§¦ Monty </span> </a> </li> <li class=md-nav__item> <a href=../../sandbox/docker/ class=md-nav__link> <span class=md-ellipsis> ğŸ³ Docker </span> </a> </li> <li class=md-nav__item> <a href=../../sandbox/cloud/ class=md-nav__link> <span class=md-ellipsis> â˜ï¸ Cloud </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <div class="md-nav__link md-nav__container"> <a href=../../integrations/ class="md-nav__link "> <span class=md-ellipsis> ğŸ”— Integrations </span> </a> <label class="md-nav__link " for=__nav_9_2 id=__nav_9_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> ğŸ”— Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../integrations/llm-providers/ class=md-nav__link> <span class=md-ellipsis> ğŸ¤– LLM Providers </span> </a> </li> <li class=md-nav__item> <a href=../../integrations/mcp/ class=md-nav__link> <span class=md-ellipsis> ğŸ”Œ MCP Server </span> </a> </li> <li class=md-nav__item> <a href=../../integrations/codemode/ class=md-nav__link> <span class=md-ellipsis> ğŸ§ª CodeMode Integration </span> </a> </li> <li class=md-nav__item> <a href=../../integrations/frameworks/ class=md-nav__link> <span class=md-ellipsis> ğŸ§© Frameworks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <div class="md-nav__link md-nav__container"> <a href=../../reference/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“– Reference </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> ğŸ“– Reference </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#classes class=md-nav__link> <span class=md-ellipsis> Classes </span> </a> <nav class=md-nav aria-label=Classes> <ul class=md-nav__list> <li class=md-nav__item> <a href=#compactionconfig class=md-nav__link> <span class=md-ellipsis> CompactionConfig </span> </a> <nav class=md-nav aria-label=CompactionConfig> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuration-fields class=md-nav__link> <span class=md-ellipsis> Configuration Fields </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#compactionresult class=md-nav__link> <span class=md-ellipsis> CompactionResult </span> </a> <nav class=md-nav aria-label=CompactionResult> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fields class=md-nav__link> <span class=md-ellipsis> Fields </span> </a> </li> <li class=md-nav__item> <a href=#properties class=md-nav__link> <span class=md-ellipsis> Properties </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#memorycompactor class=md-nav__link> <span class=md-ellipsis> MemoryCompactor </span> </a> <nav class=md-nav aria-label=MemoryCompactor> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#methods class=md-nav__link> <span class=md-ellipsis> Methods </span> </a> <nav class=md-nav aria-label=Methods> <ul class=md-nav__list> <li class=md-nav__item> <a href=#set_llm_connectorconnector class=md-nav__link> <span class=md-ellipsis> set_llm_connector(connector) </span> </a> </li> <li class=md-nav__item> <a href=#should_compacthistory class=md-nav__link> <span class=md-ellipsis> should_compact(history) </span> </a> </li> <li class=md-nav__item> <a href=#compacthistory-task-forcefalse class=md-nav__link> <span class=md-ellipsis> compact(history, task="", force=False) </span> </a> </li> <li class=md-nav__item> <a href=#apply_compactionhistory-compaction_result class=md-nav__link> <span class=md-ellipsis> apply_compaction(history, compaction_result) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#entry-preservation-strategy class=md-nav__link> <span class=md-ellipsis> Entry Preservation Strategy </span> </a> </li> <li class=md-nav__item> <a href=#summarization-strategies class=md-nav__link> <span class=md-ellipsis> Summarization Strategies </span> </a> <nav class=md-nav aria-label="Summarization Strategies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#llm-based-summarization class=md-nav__link> <span class=md-ellipsis> LLM-Based Summarization </span> </a> </li> <li class=md-nav__item> <a href=#deterministic-summarization class=md-nav__link> <span class=md-ellipsis> Deterministic Summarization </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conversationmemory class=md-nav__link> <span class=md-ellipsis> ConversationMemory </span> </a> <nav class=md-nav aria-label=ConversationMemory> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constructor_1 class=md-nav__link> <span class=md-ellipsis> Constructor </span> </a> </li> <li class=md-nav__item> <a href=#methods_1 class=md-nav__link> <span class=md-ellipsis> Methods </span> </a> </li> <li class=md-nav__item> <a href=#context-format class=md-nav__link> <span class=md-ellipsis> Context Format </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#end-to-end-example class=md-nav__link> <span class=md-ellipsis> End-to-End Example </span> </a> </li> <li class=md-nav__item> <a href=#configuration-recipes class=md-nav__link> <span class=md-ellipsis> Configuration Recipes </span> </a> <nav class=md-nav aria-label="Configuration Recipes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#high-throughput-benchmarks class=md-nav__link> <span class=md-ellipsis> High-Throughput Benchmarks </span> </a> </li> <li class=md-nav__item> <a href=#long-running-research-sessions class=md-nav__link> <span class=md-ellipsis> Long-Running Research Sessions </span> </a> </li> <li class=md-nav__item> <a href=#minimal-memory-small-context-window-models class=md-nav__link> <span class=md-ellipsis> Minimal Memory (Small Context Window Models) </span> </a> </li> <li class=md-nav__item> <a href=#no-compaction-large-context-window-models class=md-nav__link> <span class=md-ellipsis> No Compaction (Large Context Window Models) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../.. class=md-path__link> <span class=md-ellipsis> ğŸ  Home </span> </a> </li> <li class=md-path__item> <a href=../ class=md-path__link> <span class=md-ellipsis> ğŸ§  Core Engine </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=memory-compaction>Memory Compaction<a class=headerlink href=#memory-compaction title="Permanent link">&para;</a></h1> <div class="admonition info"> <p class=admonition-title>Module</p> <p><code>rlm_code.rlm.memory_compaction</code></p> </div> <p>The memory compaction module prevents context window bloat by summarizing interaction history between REPL turns. Based on patterns from the RLM-From-Scratch implementation, it provides both LLM-based and deterministic summarization strategies with configurable triggers.</p> <hr> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>As the RLM iterates through its think-code-observe loop, the interaction history grows with each step. Without compaction, the accumulated history of reasoning, code, and outputs can quickly consume the LLM's context window, leaving insufficient room for the actual task context and new reasoning.</p> <p>Memory compaction solves this by:</p> <ol> <li><strong>Detecting</strong> when history has grown too large (by entry count or character count)</li> <li><strong>Summarizing</strong> older entries into a compact summary</li> <li><strong>Preserving</strong> the most recent entries in full detail</li> <li><strong>Replacing</strong> the original history with the compacted version</li> </ol> <pre class=mermaid><code>graph TD
    A[REPL History: 12 entries] --&gt; B{Should compact?}
    B --&gt;|entries &gt;= 10| C[Split: old vs recent]
    C --&gt; D[Summarize old entries]
    C --&gt; E[Preserve last 2 entries]
    D --&gt; F[Compacted History]
    E --&gt; F
    F --&gt; G[Summary + 2 preserved = 3 entries]</code></pre> <hr> <h2 id=classes>Classes<a class=headerlink href=#classes title="Permanent link">&para;</a></h2> <h3 id=compactionconfig><code>CompactionConfig</code><a class=headerlink href=#compactionconfig title="Permanent link">&para;</a></h3> <p>Configuration dataclass controlling when and how compaction occurs.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.memory_compaction</span><span class=w> </span><span class=kn>import</span> <span class=n>CompactionConfig</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=c1># Default configuration</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>()</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=c1># Custom configuration for aggressive compaction</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>min_entries_for_compaction</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    <span class=n>max_chars_before_compaction</span><span class=o>=</span><span class=mi>4000</span><span class=p>,</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    <span class=n>summary_max_sentences</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=n>preserve_last_n_entries</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>    <span class=n>include_key_findings</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>    <span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    <span class=n>fallback_to_deterministic</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=p>)</span>
</span></code></pre></div> <h4 id=configuration-fields>Configuration Fields<a class=headerlink href=#configuration-fields title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Field</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>min_entries_for_compaction</code></td> <td><code>int</code></td> <td><code>5</code></td> <td>Minimum entries required before compaction can trigger.</td> </tr> <tr> <td><code>max_entries_before_compaction</code></td> <td><code>int</code></td> <td><code>10</code></td> <td>Force compaction when entry count reaches this threshold.</td> </tr> <tr> <td><code>max_chars_before_compaction</code></td> <td><code>int</code></td> <td><code>8000</code></td> <td>Force compaction when total character count reaches this threshold.</td> </tr> <tr> <td><code>summary_max_sentences</code></td> <td><code>int</code></td> <td><code>3</code></td> <td>Maximum sentences in the generated summary.</td> </tr> <tr> <td><code>preserve_last_n_entries</code></td> <td><code>int</code></td> <td><code>2</code></td> <td>Number of most recent entries to preserve in full.</td> </tr> <tr> <td><code>include_key_findings</code></td> <td><code>bool</code></td> <td><code>True</code></td> <td>Include extracted key findings in deterministic summaries.</td> </tr> <tr> <td><code>use_llm_for_summary</code></td> <td><code>bool</code></td> <td><code>True</code></td> <td>Use the LLM to generate summaries (higher quality).</td> </tr> <tr> <td><code>fallback_to_deterministic</code></td> <td><code>bool</code></td> <td><code>True</code></td> <td>Fall back to deterministic summarization if LLM fails.</td> </tr> </tbody> </table> <div class="admonition tip"> <p class=admonition-title>Tuning Compaction Thresholds</p> <p>For models with smaller context windows (e.g., 8K tokens), lower the <code>max_entries_before_compaction</code> to <code>5</code> and <code>max_chars_before_compaction</code> to <code>3000</code>. For large-context models (128K+), you can increase these significantly or even disable compaction for short tasks.</p> </div> <hr> <h3 id=compactionresult><code>CompactionResult</code><a class=headerlink href=#compactionresult title="Permanent link">&para;</a></h3> <p>Dataclass holding the result of a compaction operation, including metrics about the compression achieved.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.memory_compaction</span><span class=w> </span><span class=kn>import</span> <span class=n>CompactionResult</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1># Returned by MemoryCompactor.compact()</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>result</span><span class=p>:</span> <span class=n>CompactionResult</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Compressed </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>original_entries</span><span class=si>}</span><span class=s2> entries to </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>compacted_entries</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Character reduction: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>original_chars</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>compacted_chars</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Compression ratio: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>compression_ratio</span><span class=si>:</span><span class=s2>.1%</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Used LLM: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>used_llm</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h4 id=fields>Fields<a class=headerlink href=#fields title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Field</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>original_entries</code></td> <td><code>int</code></td> <td>Number of entries before compaction.</td> </tr> <tr> <td><code>compacted_entries</code></td> <td><code>int</code></td> <td>Number of entries after compaction (1 summary + preserved).</td> </tr> <tr> <td><code>original_chars</code></td> <td><code>int</code></td> <td>Total characters before compaction.</td> </tr> <tr> <td><code>compacted_chars</code></td> <td><code>int</code></td> <td>Total characters after compaction.</td> </tr> <tr> <td><code>summary</code></td> <td><code>str</code></td> <td>The generated summary text.</td> </tr> <tr> <td><code>preserved_entries</code></td> <td><code>list[REPLEntry]</code></td> <td>The preserved recent entries.</td> </tr> <tr> <td><code>timestamp</code></td> <td><code>str</code></td> <td>ISO 8601 UTC timestamp of when compaction occurred.</td> </tr> <tr> <td><code>used_llm</code></td> <td><code>bool</code></td> <td>Whether LLM-based summarization was used.</td> </tr> </tbody> </table> <h4 id=properties>Properties<a class=headerlink href=#properties title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Property</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>compression_ratio</code></td> <td><code>float</code></td> <td>Ratio of characters removed (<code>1.0 - compacted/original</code>). Returns <code>0.0</code> if original was empty.</td> </tr> </tbody> </table> <div class="admonition info"> <p class=admonition-title>Compression Ratio</p> <p>A compression ratio of <code>0.75</code> means 75% of the original characters were removed. Typical LLM-based compaction achieves 0.6--0.8 compression; deterministic compaction typically achieves 0.4--0.6.</p> </div> <hr> <h3 id=memorycompactor><code>MemoryCompactor</code><a class=headerlink href=#memorycompactor title="Permanent link">&para;</a></h3> <p>The primary compaction engine. Supports LLM-based summarization with deterministic fallback.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.memory_compaction</span><span class=w> </span><span class=kn>import</span> <span class=n>MemoryCompactor</span><span class=p>,</span> <span class=n>CompactionConfig</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=c1># Default compactor</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>()</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1># Compactor with custom config and LLM connector</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>(</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=n>config</span><span class=o>=</span><span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>        <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>8</span><span class=p>,</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>        <span class=n>preserve_last_n_entries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>    <span class=p>),</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>    <span class=n>llm_connector</span><span class=o>=</span><span class=n>my_llm_connector</span><span class=p>,</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=p>)</span>
</span></code></pre></div> <h4 id=constructor>Constructor<a class=headerlink href=#constructor title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>config</code></td> <td><code>CompactionConfig \| None</code></td> <td><code>CompactionConfig()</code></td> <td>Compaction configuration.</td> </tr> <tr> <td><code>llm_connector</code></td> <td><code>Any</code></td> <td><code>None</code></td> <td>LLM connector for summarization (must implement <code>generate_response(prompt=...)</code>).</td> </tr> </tbody> </table> <h4 id=methods>Methods<a class=headerlink href=#methods title="Permanent link">&para;</a></h4> <h5 id=set_llm_connectorconnector><code>set_llm_connector(connector)</code><a class=headerlink href=#set_llm_connectorconnector title="Permanent link">&para;</a></h5> <p>Set or update the LLM connector after construction.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>()</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># Later, when LLM is available:</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=n>compactor</span><span class=o>.</span><span class=n>set_llm_connector</span><span class=p>(</span><span class=n>my_llm_connector</span><span class=p>)</span>
</span></code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>connector</code></td> <td><code>Any</code></td> <td>LLM connector implementing <code>generate_response(prompt=...)</code>.</td> </tr> </tbody> </table> <hr> <h5 id=should_compacthistory><code>should_compact(history)</code><a class=headerlink href=#should_compacthistory title="Permanent link">&para;</a></h5> <p>Check whether the given history should be compacted based on the configured thresholds.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.repl_types</span><span class=w> </span><span class=kn>import</span> <span class=n>REPLHistory</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=n>history</span> <span class=o>=</span> <span class=n>REPLHistory</span><span class=p>()</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>12</span><span class=p>):</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=n>history</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>reasoning</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Step </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>code</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;x = </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>output</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>))</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>()</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=k>if</span> <span class=n>compactor</span><span class=o>.</span><span class=n>should_compact</span><span class=p>(</span><span class=n>history</span><span class=p>):</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;History needs compaction!&quot;</span><span class=p>)</span>
</span></code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>history</code></td> <td><code>REPLHistory</code></td> <td>The REPL history to check.</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>bool</code> -- <code>True</code> if compaction should be triggered.</p> <p><strong>Trigger logic:</strong></p> <ol> <li>If <code>len(history) &lt; min_entries_for_compaction</code>: return <code>False</code> (never compact tiny histories)</li> <li>If <code>len(history) &gt;= max_entries_before_compaction</code>: return <code>True</code></li> <li>If total character count &gt;= <code>max_chars_before_compaction</code>: return <code>True</code></li> <li>Otherwise: return <code>False</code></li> </ol> <div class="admonition note"> <p class=admonition-title>Minimum Threshold</p> <p>Compaction never triggers if the history has fewer than <code>min_entries_for_compaction</code> entries (default: 5), regardless of character count. This prevents unnecessary compaction of short histories.</p> </div> <hr> <h5 id=compacthistory-task-forcefalse><code>compact(history, task="", force=False)</code><a class=headerlink href=#compacthistory-task-forcefalse title="Permanent link">&para;</a></h5> <p>Perform the compaction, returning a <code>CompactionResult</code> with the summary and preserved entries.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>compactor</span><span class=o>.</span><span class=n>compact</span><span class=p>(</span><span class=n>history</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=s2>&quot;Analyze the dataset&quot;</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Summary: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>summary</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Preserved </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>preserved_entries</span><span class=p>)</span><span class=si>}</span><span class=s2> recent entries&quot;</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Compression: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>compression_ratio</span><span class=si>:</span><span class=s2>.0%</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>history</code></td> <td><code>REPLHistory</code></td> <td><em>required</em></td> <td>The REPL history to compact.</td> </tr> <tr> <td><code>task</code></td> <td><code>str</code></td> <td><code>""</code></td> <td>The original task description (provides context for summarization).</td> </tr> <tr> <td><code>force</code></td> <td><code>bool</code></td> <td><code>False</code></td> <td>Force compaction even if thresholds are not met.</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>CompactionResult</code></p> <p><strong>Strategy selection:</strong></p> <ol> <li>If <code>use_llm_for_summary=True</code> and connector is set: attempt LLM summarization</li> <li>If LLM fails and <code>fallback_to_deterministic=True</code>: use deterministic summary</li> <li>If LLM fails and <code>fallback_to_deterministic=False</code>: re-raise the exception</li> <li>If <code>use_llm_for_summary=False</code>: use deterministic summary directly</li> </ol> <div class="admonition warning"> <p class=admonition-title>No-Op When Thresholds Not Met</p> <p>If <code>force=False</code> and the thresholds are not met, <code>compact()</code> returns a <code>CompactionResult</code> with an empty summary and all original entries preserved. Check <code>result.summary</code> to determine whether compaction actually occurred.</p> </div> <hr> <h5 id=apply_compactionhistory-compaction_result><code>apply_compaction(history, compaction_result)</code><a class=headerlink href=#apply_compactionhistory-compaction_result title="Permanent link">&para;</a></h5> <p>Apply a <code>CompactionResult</code> to produce a new, compacted <code>REPLHistory</code>. The resulting history has a summary entry as the first item, followed by the preserved recent entries.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>compactor</span><span class=o>.</span><span class=n>compact</span><span class=p>(</span><span class=n>history</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=s2>&quot;Analyze data&quot;</span><span class=p>)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>compacted_history</span> <span class=o>=</span> <span class=n>compactor</span><span class=o>.</span><span class=n>apply_compaction</span><span class=p>(</span><span class=n>history</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Original: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>history</span><span class=p>)</span><span class=si>}</span><span class=s2> entries&quot;</span><span class=p>)</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Compacted: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>compacted_history</span><span class=p>)</span><span class=si>}</span><span class=s2> entries&quot;</span><span class=p>)</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=c1># The first entry contains the summary</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=n>first</span> <span class=o>=</span> <span class=n>compacted_history</span><span class=o>.</span><span class=n>entries</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=nb>print</span><span class=p>(</span><span class=n>first</span><span class=o>.</span><span class=n>reasoning</span><span class=p>)</span>   <span class=c1># &quot;[COMPACTED] Working on: Analyze data. Completed 8 steps...&quot;</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=nb>print</span><span class=p>(</span><span class=n>first</span><span class=o>.</span><span class=n>code</span><span class=p>)</span>        <span class=c1># &quot;# Previous steps summarized above&quot;</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=nb>print</span><span class=p>(</span><span class=n>first</span><span class=o>.</span><span class=n>output</span><span class=p>)</span>      <span class=c1># &quot;(Compacted 10 steps)&quot;</span>
</span></code></pre></div> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>history</code></td> <td><code>REPLHistory</code></td> <td>The original history.</td> </tr> <tr> <td><code>compaction_result</code></td> <td><code>CompactionResult</code></td> <td>The result from <code>compact()</code>.</td> </tr> </tbody> </table> <p><strong>Returns:</strong> <code>REPLHistory</code> -- a new compacted history instance.</p> <div class="admonition info"> <p class=admonition-title>Summary Entry Format</p> <p>The summary entry uses a special format that the LLM can recognize:</p> <ul> <li><strong>Reasoning:</strong> <code>[COMPACTED] &lt;summary text&gt;</code></li> <li><strong>Code:</strong> <code># Previous steps summarized above</code></li> <li><strong>Output:</strong> <code>(Compacted N steps)</code></li> </ul> <p>If the <code>CompactionResult</code> has an empty summary (no compaction performed), the original history is returned unchanged.</p> </div> <hr> <h3 id=entry-preservation-strategy>Entry Preservation Strategy<a class=headerlink href=#entry-preservation-strategy title="Permanent link">&para;</a></h3> <p>The compactor preserves the <code>preserve_last_n_entries</code> most recent entries unchanged. This ensures the LLM has immediate access to its latest work without needing to re-derive it from a summary.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>Before compaction:
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>  [Step 1] [Step 2] [Step 3] [Step 4] [Step 5] [Step 6] [Step 7] [Step 8]
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>                                                          ^^^^^^^^^^^^^^^^^
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>                                                          preserve_last_n=2
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>After compaction:
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>  [SUMMARY of Steps 1-6]  [Step 7]  [Step 8]
</span></code></pre></div> <hr> <h3 id=summarization-strategies>Summarization Strategies<a class=headerlink href=#summarization-strategies title="Permanent link">&para;</a></h3> <p>The compactor supports two summarization strategies, selected based on configuration and availability.</p> <h4 id=llm-based-summarization>LLM-Based Summarization<a class=headerlink href=#llm-based-summarization title="Permanent link">&para;</a></h4> <p>When <code>use_llm_for_summary=True</code> and an LLM connector is provided, the compactor sends a structured prompt requesting a concise summary.</p> <p>The prompt includes:</p> <ul> <li>The original task description</li> <li>A formatted view of each step (reasoning preview up to 200 chars, code preview up to 150 chars, output preview up to 100 chars)</li> <li>Instructions to capture: what was attempted, key findings, and resolved errors</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Enable LLM summarization (default)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span><span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>(</span><span class=n>config</span><span class=o>=</span><span class=n>config</span><span class=p>,</span> <span class=n>llm_connector</span><span class=o>=</span><span class=n>my_llm</span><span class=p>)</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>LLM Summary Quality</p> <p>LLM-based summaries are typically more coherent and context-aware than deterministic ones. They excel at capturing the narrative arc of multi-step reasoning. However, they add latency and cost. For benchmark runs with many iterations, consider using deterministic summarization.</p> </div> <h4 id=deterministic-summarization>Deterministic Summarization<a class=headerlink href=#deterministic-summarization title="Permanent link">&para;</a></h4> <p>When LLM summarization is unavailable or disabled, the compactor uses a rule-based approach that extracts key information from entries using heuristics.</p> <p>The deterministic summary components:</p> <table> <thead> <tr> <th>Component</th> <th>Source</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>Task context</td> <td>First 100 chars of the task description</td> <td><code>"Working on: Analyze sentiment"</code></td> </tr> <tr> <td>Step statistics</td> <td>Count of total and successful steps</td> <td><code>"Completed 8 steps (6 successful)."</code></td> </tr> <tr> <td>LLM sub-call count</td> <td>Sum of <code>llm_calls</code> across entries</td> <td><code>"Made 3 LLM sub-calls."</code></td> </tr> <tr> <td>Key findings</td> <td>Numeric values and key-value patterns from outputs</td> <td><code>"Key findings: accuracy=0.87; total=1523"</code></td> </tr> <tr> <td>Error summary</td> <td>Types of errors encountered</td> <td><code>"Resolved issues: KeyError, ValueError"</code></td> </tr> </tbody> </table> <p><strong>Success detection:</strong> An output is considered "successful" if it does not contain any of the keywords <code>error</code>, <code>exception</code>, <code>traceback</code>, or <code>failed</code> (case-insensitive).</p> <p><strong>Key findings extraction:</strong></p> <ul> <li>Numeric values are extracted via regex (<code>\b\d+(?:,\d{3})*(?:\.\d+)?\b</code>)</li> <li>Key-value patterns are matched with <code>(\w+):\s*([^\n,]+)</code></li> <li>Up to 3 findings are included</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># Force deterministic summarization</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span><span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>(</span><span class=n>config</span><span class=o>=</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=n>result</span> <span class=o>=</span> <span class=n>compactor</span><span class=o>.</span><span class=n>compact</span><span class=p>(</span><span class=n>history</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=s2>&quot;Parse the log file&quot;</span><span class=p>)</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>summary</span><span class=p>)</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=c1># &quot;Working on: Parse the log file. Completed 8 steps (6 successful).</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=c1>#  Made 3 LLM sub-calls. Key findings: lines=1024; errors=12.</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=c1>#  Resolved issues: KeyError, ValueError&quot;</span>
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Fallback Behavior</p> <p>When <code>fallback_to_deterministic=True</code> (the default), LLM summarization failures silently fall back to deterministic summarization. Set <code>fallback_to_deterministic=False</code> to let LLM errors propagate if you need strict quality guarantees.</p> </div> <hr> <h3 id=conversationmemory><code>ConversationMemory</code><a class=headerlink href=#conversationmemory title="Permanent link">&para;</a></h3> <p>Manages memory across multiple conversation turns in chat-style interactions. Provides automatic compaction of turn history and context retrieval for the LLM.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.memory_compaction</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversationMemory</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=n>memory</span> <span class=o>=</span> <span class=n>ConversationMemory</span><span class=p>(</span><span class=n>max_turns</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=c1># Add conversation turns</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=n>memory</span><span class=o>.</span><span class=n>add_turn</span><span class=p>(</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>    <span class=n>user_message</span><span class=o>=</span><span class=s2>&quot;What&#39;s in the dataset?&quot;</span><span class=p>,</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>    <span class=n>assistant_response</span><span class=o>=</span><span class=s2>&quot;The dataset contains 1000 records with 5 columns...&quot;</span><span class=p>,</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=n>task</span><span class=o>=</span><span class=s2>&quot;Analyze dataset&quot;</span><span class=p>,</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=n>memory</span><span class=o>.</span><span class=n>add_turn</span><span class=p>(</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>    <span class=n>user_message</span><span class=o>=</span><span class=s2>&quot;Find the outliers&quot;</span><span class=p>,</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>    <span class=n>assistant_response</span><span class=o>=</span><span class=s2>&quot;I found 12 outliers in column &#39;price&#39;...&quot;</span><span class=p>,</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=p>)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=c1># Get context for next LLM call</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=n>context</span> <span class=o>=</span> <span class=n>memory</span><span class=o>.</span><span class=n>get_context</span><span class=p>()</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=nb>print</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
</span></code></pre></div> <h4 id=constructor_1>Constructor<a class=headerlink href=#constructor_1 title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Parameter</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>compactor</code></td> <td><code>MemoryCompactor \| None</code></td> <td><code>MemoryCompactor()</code></td> <td>Compactor for REPL history within turns.</td> </tr> <tr> <td><code>max_turns</code></td> <td><code>int</code></td> <td><code>20</code></td> <td>Maximum turns to retain before auto-compaction.</td> </tr> </tbody> </table> <h4 id=methods_1>Methods<a class=headerlink href=#methods_1 title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Method</th> <th>Signature</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>add_turn</code></td> <td><code>(user_message, assistant_response, history=None, task="")</code></td> <td>Add a conversation turn. Auto-compacts if <code>max_turns</code> exceeded.</td> </tr> <tr> <td><code>get_context</code></td> <td><code>() -&gt; str</code></td> <td>Get formatted conversation context for the LLM (last 5 turns).</td> </tr> <tr> <td><code>clear</code></td> <td><code>() -&gt; None</code></td> <td>Clear all memory (turns and compacted summary).</td> </tr> </tbody> </table> <div class="admonition info"> <p class=admonition-title>Auto-Compaction of Turns</p> <p>When the number of turns exceeds <code>max_turns</code>, the older half is compacted into a summary string. The summary preserves the first 100 characters of each user message and assistant response from up to 3 of the compacted turns.</p> </div> <h4 id=context-format>Context Format<a class=headerlink href=#context-format title="Permanent link">&para;</a></h4> <p>The <code>get_context()</code> method returns a formatted string suitable for inclusion in an LLM prompt:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>[Previous conversation (10 turns): Q: What&#39;s in the dataset?... A: The dataset contains...
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a> | Q: Find the outliers... A: I found 12 outliers...]
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>User: Show me a histogram of prices
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>Assistant: Here&#39;s the histogram showing...
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>User: What&#39;s the median price?
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>Assistant: The median price is $45.50...
</span></code></pre></div> <hr> <h2 id=end-to-end-example>End-to-End Example<a class=headerlink href=#end-to-end-example title="Permanent link">&para;</a></h2> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.memory_compaction</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=n>MemoryCompactor</span><span class=p>,</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>CompactionConfig</span><span class=p>,</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>ConversationMemory</span><span class=p>,</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=p>)</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=kn>from</span><span class=w> </span><span class=nn>rlm_code.rlm.repl_types</span><span class=w> </span><span class=kn>import</span> <span class=n>REPLHistory</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=c1># 1. Configure compaction</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>    <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>8</span><span class=p>,</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>    <span class=n>max_chars_before_compaction</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=n>preserve_last_n_entries</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=n>summary_max_sentences</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>    <span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># Deterministic for this example</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=p>)</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=c1># 2. Create compactor</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=n>compactor</span> <span class=o>=</span> <span class=n>MemoryCompactor</span><span class=p>(</span><span class=n>config</span><span class=o>=</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=c1># 3. Simulate REPL history building</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=n>history</span> <span class=o>=</span> <span class=n>REPLHistory</span><span class=p>()</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>    <span class=n>history</span> <span class=o>=</span> <span class=n>history</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>        <span class=n>reasoning</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Step </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>: analyzing chunk </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>        <span class=n>code</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;result_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2> = analyze(chunks[</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>])&quot;</span><span class=p>,</span>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>        <span class=n>output</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Processed chunk </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>: found </span><span class=si>{</span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>3</span><span class=si>}</span><span class=s2> patterns&quot;</span><span class=p>,</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>    <span class=p>)</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=c1># 4. Check and compact</span>
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=k>if</span> <span class=n>compactor</span><span class=o>.</span><span class=n>should_compact</span><span class=p>(</span><span class=n>history</span><span class=p>):</span>
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>compactor</span><span class=o>.</span><span class=n>compact</span><span class=p>(</span><span class=n>history</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=s2>&quot;Analyze all data chunks&quot;</span><span class=p>)</span>
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Compression ratio: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>compression_ratio</span><span class=si>:</span><span class=s2>.0%</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a>    <span class=c1># 5. Apply compaction</span>
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a>    <span class=n>compacted</span> <span class=o>=</span> <span class=n>compactor</span><span class=o>.</span><span class=n>apply_compaction</span><span class=p>(</span><span class=n>history</span><span class=p>,</span> <span class=n>result</span><span class=p>)</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Entries: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>history</span><span class=p>)</span><span class=si>}</span><span class=s2> -&gt; </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>compacted</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a>    <span class=c1># Entries: 10 -&gt; 3  (1 summary + 2 preserved)</span>
</span></code></pre></div> <hr> <h2 id=configuration-recipes>Configuration Recipes<a class=headerlink href=#configuration-recipes title="Permanent link">&para;</a></h2> <h3 id=high-throughput-benchmarks>High-Throughput Benchmarks<a class=headerlink href=#high-throughput-benchmarks title="Permanent link">&para;</a></h3> <p>Minimize overhead by using deterministic summarization and aggressive compaction:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=n>min_entries_for_compaction</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>    <span class=n>max_chars_before_compaction</span><span class=o>=</span><span class=mi>3000</span><span class=p>,</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>    <span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># Avoid extra LLM calls</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>    <span class=n>preserve_last_n_entries</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>    <span class=n>summary_max_sentences</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=p>)</span>
</span></code></pre></div> <h3 id=long-running-research-sessions>Long-Running Research Sessions<a class=headerlink href=#long-running-research-sessions title="Permanent link">&para;</a></h3> <p>Preserve more context and use LLM for higher-quality summaries:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>    <span class=n>min_entries_for_compaction</span><span class=o>=</span><span class=mi>8</span><span class=p>,</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>    <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>15</span><span class=p>,</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>    <span class=n>max_chars_before_compaction</span><span class=o>=</span><span class=mi>15000</span><span class=p>,</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>    <span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=n>fallback_to_deterministic</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=n>preserve_last_n_entries</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>    <span class=n>summary_max_sentences</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>    <span class=n>include_key_findings</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=p>)</span>
</span></code></pre></div> <h3 id=minimal-memory-small-context-window-models>Minimal Memory (Small Context Window Models)<a class=headerlink href=#minimal-memory-small-context-window-models title="Permanent link">&para;</a></h3> <p>Compact as early and aggressively as possible:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>    <span class=n>min_entries_for_compaction</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>max_chars_before_compaction</span><span class=o>=</span><span class=mi>2000</span><span class=p>,</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>    <span class=n>use_llm_for_summary</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=n>preserve_last_n_entries</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=n>summary_max_sentences</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=p>)</span>
</span></code></pre></div> <h3 id=no-compaction-large-context-window-models>No Compaction (Large Context Window Models)<a class=headerlink href=#no-compaction-large-context-window-models title="Permanent link">&para;</a></h3> <p>Disable compaction entirely for short tasks with large-context models:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>config</span> <span class=o>=</span> <span class=n>CompactionConfig</span><span class=p>(</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>    <span class=n>min_entries_for_compaction</span><span class=o>=</span><span class=mi>999</span><span class=p>,</span>  <span class=c1># Effectively never trigger</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=n>max_entries_before_compaction</span><span class=o>=</span><span class=mi>999</span><span class=p>,</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>max_chars_before_compaction</span><span class=o>=</span><span class=mi>999999</span><span class=p>,</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=p>)</span>
</span></code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Brought to You by <a href=https://super-agentic.ai target=_blank rel=noopener>Superagentic AI</a> </div> </div> <div class=md-social> <a href=https://github.com/SuperagenticAI/rlm-code target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://pypi.org/project/rlm-code/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>